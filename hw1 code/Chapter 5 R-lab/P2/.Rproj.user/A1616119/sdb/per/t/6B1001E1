{
    "collab_server" : "",
    "contents" : "# Problem P2: Chapter 5 R-lab\n\n# Problem 1\nlibrary(\"Ecdat\")\n?CPSch3\ndata(CPSch3)\ndimnames(CPSch3)[[2]]\nmale.earnings = CPSch3[CPSch3[,3]==\"male\",2]\nsqrt.male.earnings = sqrt(male.earnings)\nlog.male.earnings = log(male.earnings)\ncub.male.earnings = male.earnings^(1/4)\n\npar(mfrow=c(2,2))\nqqnorm(male.earnings,datax=T,main=\"untransformed\")\nqqnorm(sqrt.male.earnings,datax=T,main=\"square-root transformed\")\nqqnorm(log.male.earnings,datax=T,main=\"log-transformed\")\nqqnorm(cub.male.earnings,datax=T,main=\"power = 1/4 transformed\")\n\npar(mfrow=c(2,2))\nboxplot(male.earnings,main=\"untransformed\")\nboxplot(sqrt.male.earnings,main=\"square-root transformed\")\nboxplot(log.male.earnings,main=\"log-transformed\")\nboxplot(cub.male.earnings,main=\"power = 1/4 transfromed\")\n\npar(mfrow=c(2,2))\nplot(density(male.earnings),main=\"untransformed\")\nplot(density(sqrt.male.earnings),main=\"square-root transformed\")\nplot(density(log.male.earnings),main=\"log-transformed\")\nplot(density(cub.male.earnings),main=\"power = 1/4 transformed\")\n\n# Problem 2\nlibrary(\"MASS\")\n#quartz()\nboxcox(male.earnings~1)\nboxcox(male.earnings~1,lambda = seq(.3, .45, 1/100))\nbc = boxcox(male.earnings~1,lambda = seq(.3, .45, by=1/100),interp=F)\nind = (bc$y==max(bc$y))\nind2 = (bc$y > max(bc$y) - qchisq(.95,df=1)/2) #.99 confidence interval\nbc$x[ind]\nbc$x[ind2]\n\n# Problem 3\nlibrary(\"fGarch\")\nfit = sstdFit(male.earnings,hessian=T)\n\n# Problem 4\n#quartz()\nplot(density(male.earnings),type=\"l\",xlab=\"x: male earning\",ylab=\"density\")\nx_val=seq(min(male.earnings),max(male.earnings),length.out=150)\ny_val=dsstd(x_val,mean=fit$estimate[1],sd=fit$estimate[2],nu=fit$estimate[3],xi=fit$estimate[4])\nlines(x_val,y_val,lwd=3,lty=6)\nlegend(\"topright\",c(\"KDE\",\"Skewed Student t\"),lwd=2,lty=c(1,5))\n\n# Problem 5\nfit_sqed=sqedFit(male.earnings)\n#quartz()\nplot(density(male.earnings),type=\"l\",xlab=\"x: male earning\",ylab=\"density\")\nx_val=seq(min(male.earnings),max(male.earnings),length.out=150)\ny_val=dsged(x_val,mean=fit_sqed$par[1],sd=fit_sqed$par[2],nu=fit_sqed$par[3],xi=fit_sqed$par[4])\nlines(x_val,y_val,lwd=3,lty=6)\nlegend(\"topright\",c(\"KDE\",\"Skewed GED\"),lwd=2,lty=c(1,5))\n\n\n#5.20.2 DAX Returns\n# Problem 6\ndata(Garch,package=\"Ecdat\")\nlibrary(\"fGarch\")\ndata(EuStockMarkets)\nY = diff(log(EuStockMarkets[,1]))  #  DAX\n#####  std  #####\nloglik_std = function(x) {\n  f = -sum(log(dstd(Y, x[1], x[2], x[3])))\n  f}\nstart=c(mean(Y),sd(Y),4)\nfit_std = optim(start,loglik_std,method=\"L-BFGS-B\",\n                lower=c(-.1,.001,2.1),\n                upper=c(.1,1,20))\nprint(c(\"MLE =\",round(fit_std$par,digits=5)))\nm_logL_std = fit_std$value  # minus the log-likelihood\nAIC_std = 2*m_logL_std+2*length(fit_std$par)\n\n# Problem 7\nloglik_std = function(x) {\n  f = -sum(log(dsstd(Y, mean=x[1], sd=x[2], nu=x[3], xi=x[4])))\n  f}\nstart=c(mean(Y),sd(Y),4,1.5) # optimization starting point\nfit_sstd = optim(start,loglik_std,method=\"L-BFGS-B\",\n                 lower=c(-.1,.001,2.1,0.5),\n                 upper=c(.1,1,20,3))\nprint(c(\"MLE =\",round(fit_sstd$par,digits=5)))\nm_logL_sstd = fit_sstd$value  # minus the log-likelihood\nAIC_std = 2*m_logL_sstd+2*length(fit_sstd$par)\n\n# Problem 8\nx1=pstd(Y,mean=fit_std$par[1],sd=fit_std$par[2],nu=fit_std$par[3])\nx=qnorm(x1)\npar(mfrow=c(1,1))\nd1=density(Y)\nplot(d1$x,d1$y,type=\"l\",lty=1, xlab=\"y\",ylab=\"density(y)\")\n\nd2=density(x)\nginvx=qstd(pnorm(d2$x),mean=fit_std$par[1],sd=fit_std$par[2],nu=fit_std$par[3])\ngprime_num=dstd(ginvx,mean=fit_std$par[1],sd=fit_std$par[2],nu=fit_std$par[3])\ngprime_den=dnorm(qnorm(pstd(ginvx,mean=fit_std$par[1],sd=fit_std$par[2],nu=fit_std$par[3])))\ngprime=gprime_num/gprime_den\nlines(ginvx,d2$y*gprime,type=\"l\",lty=2)\nlegend(\"topleft\",c(\"KDE\",\"TKDE\"),lty=c(1,2),lwd=2,cex=1.5)\n\n# Problem 9\nd1=density(Y)\nplot(d1$x,d1$y,type=\"l\",lty=1, xlab=\"y\",ylab=\"density(y)\",xlim=c(0.035,0.06),ylim=c(0,2))\n\nd2=density(x)\nginvx=qstd(pnorm(d2$x),mean=fit_std$par[1],sd=fit_std$par[2],nu=fit_std$par[3])\ngprime_num=dstd(ginvx,mean=fit_std$par[1],sd=fit_std$par[2],nu=fit_std$par[3])\ngprime_den=dnorm(qnorm(pstd(ginvx,mean=fit_std$par[1],sd=fit_std$par[2],nu=fit_std$par[3])))\ngprime=gprime_num/gprime_den\nlines(ginvx,d2$y*gprime,type=\"l\",lty=2)\n\nx_values=seq(min(Y),max(Y),length.out=150 )\nlines(x_values,dstd(x_values,mean=fit_std$par[1],sd=fit_std$par[2],nu=fit_std$par[3]), type=\"l\", lty=5 )\nlegend(\"topleft\",c(\"KDE\",\"TKDE\",\"Parametric Estimator\"),lty=c(1,2,5),lwd=1.5,cex=1.5)\n",
    "created" : 1501610698885.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "4118930661",
    "id" : "6B1001E1",
    "lastKnownWriteTime" : 1501615751,
    "last_content_update" : 1501615751747,
    "path" : "~/Documents/Baruch/Refresher Seminars/Statistics/Chapter 5 R-lab/P2/P2.R",
    "project_path" : "P2.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}