library("Ecdat")
?CPSch3
data(CPSch3)
dimnames(CPSch3)[[2]]
male.earnings = CPSch3[CPSch3[,3]=="male",2]
sqrt.male.earnings = sqrt(male.earnings)
log.male.earnings = log(male.earnings)
par(mfrow=c(2,2))
qqnorm(male.earnings,datax=T,main="untransformed")
qqnorm(sqrt.male.earnings,datax=T,main="square-root transformed")
qqnorm(log.male.earnings,datax=T,main="log-transformed")
par(mfrow=c(2,2))
boxplot(male.earnings,main="untransformed")
boxplot(sqrt.male.earnings,main="square-root transformed")
boxplot(log.male.earnings,main="log-transformed")
par(mfrow=c(2,2))
plot(density(male.earnings),main="untransformed")
plot(density(sqrt.male.earnings),main="square-root transformed")
plot(density(log.male.earnings),main="log-transformed")
library("Ecdat")
install.packages("Ecdat")
library("Ecdat")
?CPSch3
data(CPSch3)
dimnames(CPSch3)[[2]]
male.earnings = CPSch3[CPSch3[,3]=="male",2]
sqrt.male.earnings = sqrt(male.earnings)
log.male.earnings = log(male.earnings)
par(mfrow=c(2,2))
qqnorm(male.earnings,datax=T,main="untransformed")
qqnorm(sqrt.male.earnings,datax=T,main="square-root transformed")
qqnorm(log.male.earnings,datax=T,main="log-transformed")
par(mfrow=c(2,2))
boxplot(male.earnings,main="untransformed")
boxplot(sqrt.male.earnings,main="square-root transformed")
boxplot(log.male.earnings,main="log-transformed")
par(mfrow=c(2,2))
plot(density(male.earnings),main="untransformed")
plot(density(sqrt.male.earnings),main="square-root transformed")
plot(density(log.male.earnings),main="log-transformed")
library("Ecdat")
?CPSch3
data(CPSch3)
dimnames(CPSch3)[[2]]
male.earnings = CPSch3[CPSch3[,3]=="male",2]
sqrt.male.earnings = sqrt(male.earnings)
log.male.earnings = log(male.earnings)
par(mfrow=c(2,2))
qqnorm(male.earnings,datax=T,main="untransformed")
qqnorm(sqrt.male.earnings,datax=T,main="square-root transformed")
qqnorm(log.male.earnings,datax=T,main="log-transformed")
par(mfrow=c(2,2))
boxplot(male.earnings,main="untransformed")
boxplot(sqrt.male.earnings,main="square-root transformed")
boxplot(log.male.earnings,main="log-transformed")
boxplot(cub.male.earning,main="power = 1/4 transfromed")
par(mfrow=c(2,2))
plot(density(male.earnings),main="untransformed")
plot(density(sqrt.male.earnings),main="square-root transformed")
plot(density(log.male.earnings),main="log-transformed")
plot(density(cub.male.earning),main="power = 1/4 transformed")
# Problem 1
library("Ecdat")
?CPSch3
data(CPSch3)
dimnames(CPSch3)[[2]]
male.earnings = CPSch3[CPSch3[,3]=="male",2]
sqrt.male.earnings = sqrt(male.earnings)
log.male.earnings = log(male.earnings)
par(mfrow=c(2,2))
qqnorm(male.earnings,datax=T,main="untransformed")
qqnorm(sqrt.male.earnings,datax=T,main="square-root transformed")
qqnorm(log.male.earnings,datax=T,main="log-transformed")
par(mfrow=c(2,2))
boxplot(male.earnings,main="untransformed")
boxplot(sqrt.male.earnings,main="square-root transformed")
boxplot(log.male.earnings,main="log-transformed")
boxplot(cub.male.earnings,main="power = 1/4 transfromed")
par(mfrow=c(2,2))
plot(density(male.earnings),main="untransformed")
plot(density(sqrt.male.earnings),main="square-root transformed")
plot(density(log.male.earnings),main="log-transformed")
plot(density(cub.male.earning),main="power = 1/4 transformed")
# Problem 1
library("Ecdat")
?CPSch3
data(CPSch3)
dimnames(CPSch3)[[2]]
male.earnings = CPSch3[CPSch3[,3]=="male",2]
sqrt.male.earnings = sqrt(male.earnings)
log.male.earnings = log(male.earnings)
cub.male.earnings = male.earnings^(1/4)
par(mfrow=c(2,2))
qqnorm(male.earnings,datax=T,main="untransformed")
qqnorm(sqrt.male.earnings,datax=T,main="square-root transformed")
qqnorm(log.male.earnings,datax=T,main="log-transformed")
par(mfrow=c(2,2))
boxplot(male.earnings,main="untransformed")
boxplot(sqrt.male.earnings,main="square-root transformed")
boxplot(log.male.earnings,main="log-transformed")
boxplot(cub.male.earnings,main="power = 1/4 transfromed")
par(mfrow=c(2,2))
plot(density(male.earnings),main="untransformed")
plot(density(sqrt.male.earnings),main="square-root transformed")
plot(density(log.male.earnings),main="log-transformed")
plot(density(cub.male.earning),main="power = 1/4 transformed")
# Problem 1
# Problem P2: Chapter 5 R-lab
library("Ecdat")
?CPSch3
data(CPSch3)
dimnames(CPSch3)[[2]]
male.earnings = CPSch3[CPSch3[,3]=="male",2]
sqrt.male.earnings = sqrt(male.earnings)
log.male.earnings = log(male.earnings)
cub.male.earnings = male.earnings^(1/4)
par(mfrow=c(2,2))
qqnorm(male.earnings,datax=T,main="untransformed")
qqnorm(sqrt.male.earnings,datax=T,main="square-root transformed")
qqnorm(log.male.earnings,datax=T,main="log-transformed")
par(mfrow=c(2,2))
boxplot(male.earnings,main="untransformed")
boxplot(sqrt.male.earnings,main="square-root transformed")
boxplot(log.male.earnings,main="log-transformed")
boxplot(cub.male.earnings,main="power = 1/4 transfromed")
par(mfrow=c(2,2))
plot(density(male.earnings),main="untransformed")
plot(density(sqrt.male.earnings),main="square-root transformed")
plot(density(log.male.earnings),main="log-transformed")
plot(density(cub.male.earnings),main="power = 1/4 transformed")
# Problem 1
# Problem P2: Chapter 5 R-lab
library("Ecdat")
?CPSch3
data(CPSch3)
dimnames(CPSch3)[[2]]
male.earnings = CPSch3[CPSch3[,3]=="male",2]
sqrt.male.earnings = sqrt(male.earnings)
log.male.earnings = log(male.earnings)
cub.male.earnings = male.earnings^(1/4)
par(mfrow=c(2,2))
qqnorm(male.earnings,datax=T,main="untransformed")
qqnorm(sqrt.male.earnings,datax=T,main="square-root transformed")
qqnorm(log.male.earnings,datax=T,main="log-transformed")
qqnorm(cub.male.earnings,datax=T,main="power = 1/4 transformed")
par(mfrow=c(2,2))
boxplot(male.earnings,main="untransformed")
boxplot(sqrt.male.earnings,main="square-root transformed")
boxplot(log.male.earnings,main="log-transformed")
boxplot(cub.male.earnings,main="power = 1/4 transfromed")
par(mfrow=c(2,2))
plot(density(male.earnings),main="untransformed")
plot(density(sqrt.male.earnings),main="square-root transformed")
plot(density(log.male.earnings),main="log-transformed")
plot(density(cub.male.earnings),main="power = 1/4 transformed")
# Problem 1
install.packages("MASS")
library("MASS")
windows()
boxcox(male.earnings~1)
boxcox(male.earnings~1,lambda = seq(.3, .45, 1/100))
bc = boxcox(male.earnings~1,lambda = seq(.3, .45, by=1/100),interp=F)
ind = (bc$y==max(bc$y))
ind2 = (bc$y > max(bc$y) - qchisq(.95,df=1)/2)
bc$x[ind]
bc$x[ind2]
library("fGarch")
fit = sstdFit(male.earnings,hessian=T)
fit
quartz()
plot(density(male.earnings),type="1",xlab="x: male earning",ylab="density")
x_val=seq(min(male.earnings),max(male.earnings),length.out=150)
y_val=dsstd(x_val,mean=fit$estimate[1],sd=fit$estimate[2],nu=fit$estimate[3],xi=fit$estimate[4])
lines(x_val,y_val,lwd=3,lty=6)
legend("topright",C("KDE","Skewed Student t"),lwd=2,lty=c(1,5))
plot(density(male.earnings),type="1",xlab="x: male earning",ylab="density")
x_val=seq(min(male.earnings),max(male.earnings),length.out=150)
y_val=dsstd(x_val,mean=fit$estimate[1],sd=fit$estimate[2],nu=fit$estimate[3],xi=fit$estimate[4])
lines(x_val,y_val,lwd=3,lty=6)
legend("topright",C("KDE","Skewed Student t"),lwd=2,lty=c(1,5))
plot(density(male.earnings),type="1",xlab="x: male earning",ylab="density")
x_val=seq(min(male.earnings),max(male.earnings),length.out=150)
y_val=dsstd(x_val,mean=fit$estimate[1],sd=fit$estimate[2],nu=fit$estimate[3],xi=fit$estimate[4])
lines(x_val,y_val,lwd=3,lty=6)
legend("topright",C("KDE","Skewed Student t"),lwd=2,lty=c(1,5))
plot(density(male.earnings),type="1",xlab="x: male earning",ylab="density")
x_val=seq(min(male.earnings),max(male.earnings),length.out=150)
y_val=dsstd(x_val,mean=fit$estimate[1],sd=fit$estimate[2],nu=fit$estimate[3],xi=fit$estimate[4])
lines(x_val,y_val,lwd=3,lty=6)
legend("topright",C("KDE","Skewed Student t"),lwd=2,lty=c(1,5))
plot(density(male.earnings),type="1",xlab="x: male earning",ylab="density")
x_val=seq(min(male.earnings),max(male.earnings),length.out=150)
y_val=dsstd(x_val,mean=fit$estimate[1],sd=fit$estimate[2],nu=fit$estimate[3],xi=fit$estimate[4])
lines(x_val,y_val,lwd=3,lty=6)
legend("topright",C("KDE","Skewed Student t"),lwd=2,lty=c(1,5))
plot(density(male.earnings),type="1",xlab="x: male earning",ylab="density")
x_val=seq(min(male.earnings),max(male.earnings),length.out=150)
y_val=dsstd(x_val,mean=fit$estimate[1],sd=fit$estimate[2],nu=fit$estimate[3],xi=fit$estimate[4])
lines(x_val,y_val,lwd=3,lty=6)
legend("topright",C("KDE","Skewed Student t"),lwd=2,lty=c(1,5))
library("Ecdat")
?CPSch3
data(CPSch3)
dimnames(CPSch3)[[2]]
male.earnings = CPSch3[CPSch3[,3]=="male",2]
sqrt.male.earnings = sqrt(male.earnings)
log.male.earnings = log(male.earnings)
cub.male.earnings = male.earnings^(1/4)
par(mfrow=c(2,2))
qqnorm(male.earnings,datax=T,main="untransformed")
qqnorm(sqrt.male.earnings,datax=T,main="square-root transformed")
qqnorm(log.male.earnings,datax=T,main="log-transformed")
qqnorm(cub.male.earnings,datax=T,main="power = 1/4 transformed")
par(mfrow=c(2,2))
boxplot(male.earnings,main="untransformed")
boxplot(sqrt.male.earnings,main="square-root transformed")
boxplot(log.male.earnings,main="log-transformed")
boxplot(cub.male.earnings,main="power = 1/4 transfromed")
par(mfrow=c(2,2))
plot(density(male.earnings),main="untransformed")
plot(density(sqrt.male.earnings),main="square-root transformed")
plot(density(log.male.earnings),main="log-transformed")
plot(density(cub.male.earnings),main="power = 1/4 transformed")
library("MASS")
boxcox(male.earnings~1)
boxcox(male.earnings~1,lambda = seq(.3, .45, 1/100))
bc = boxcox(male.earnings~1,lambda = seq(.3, .45, by=1/100),interp=F)
ind = (bc$y==max(bc$y))
ind2 = (bc$y > max(bc$y) - qchisq(.95,df=1)/2) #.99 confidence interval
bc$x[ind]
bc$x[ind2]
library("fGarch")
fit = sstdFit(male.earnings,hessian=T)
plot(density(male.earnings),type="1",xlab="x: male earning",ylab="density")
x_val=seq(min(male.earnings),max(male.earnings),length.out=150)
y_val=dsstd(x_val,mean=fit$estimate[1],sd=fit$estimate[2],nu=fit$estimate[3],xi=fit$estimate[4])
lines(x_val,y_val,lwd=3,lty=6)
legend("topright",C("KDE","Skewed Student t"),lwd=2,lty=c(1,5))
legend("topright",c("KDE","Skewed Student t"),lwd=2,lty=c(1,5))
plot(density(male.earnings),type="l",xlab="x: male earning",ylab="density")
x_val=seq(min(male.earnings),max(male.earnings),length.out=150)
y_val=dsstd(x_val,mean=fit$estimate[1],sd=fit$estimate[2],nu=fit$estimate[3],xi=fit$estimate[4])
lines(x_val,y_val,lwd=3,lty=6)
legend("topright",c("KDE","Skewed Student t"),lwd=2,lty=c(1,5))
library("Ecdat")
?CPSch3
data(CPSch3)
dimnames(CPSch3)[[2]]
male.earnings = CPSch3[CPSch3[,3]=="male",2]
sqrt.male.earnings = sqrt(male.earnings)
log.male.earnings = log(male.earnings)
cub.male.earnings = male.earnings^(1/4)
plot(density(male.earnings),type="l",xlab="x: male earning",ylab="density")
x_val=seq(min(male.earnings),max(male.earnings),length.out=150)
y_val=dsstd(x_val,mean=fit$estimate[1],sd=fit$estimate[2],nu=fit$estimate[3],xi=fit$estimate[4])
lines(x_val,y_val,lwd=3,lty=6)
legend("topright",c("KDE","Skewed Student t"),lwd=2,lty=c(1,5))
fit_sqed=sqedFit(male.earnings)
#quartz()
plot(density(male.earnings),type="l",xlab="x: male earning",ylab="density")
x_val=seq(min(male.earnings),max(male.earnings),length.out=150)
y_val=dsged(x_val,mean=fit_sqed$par[1],sd=fit_sqed$par[2],nu=fit_sqed$par[3],xi=fit_sqed$par[4])
lines(x_val,y_val,lwd=3,lty=6)
legend("topright",c("KDE","Skewed GED"),lwd=2,lty=c(1,5))
plot(density(male.earnings),type="l",xlab="x: male earning",ylab="density")
x_val=seq(min(male.earnings),max(male.earnings),length.out=150)
y_val=dsged(x_val,mean=fit_sqed$par[1],sd=fit_sqed$par[2],nu=fit_sqed$par[3],xi=fit_sqed$par[4])
lines(x_val,y_val,lwd=3,lty=6)
legend("topright",c("KDE","Skewed GED"),lwd=2,lty=c(1,5))
data(Garch,package="Ecdat")
library("fGarch")
data(EuStockMarkets)
Y = diff(log(EuStockMarkets[,1]))  #  DAX
loglik_std = function(x) {
f = -sum(log(dstd(Y, x[1], x[2], x[3])))
f}
start=c(mean(Y),sd(Y),4)
fit_std = optim(start,loglik_std,method="L-BFGS-B",
lower=c(-.1,.001,2.1),
upper=c(.1,1,20))
print(c("MLE =",round(fit_std$par,digits=5)))
m_logL_std = fit_std$value  # minus the log-likelihood
AIC_std = 2*m_logL_std+2*length(fit_std$par)
AIC_std
fit_std
loglik_std = function(x) {
f = -sum(log(dsstd(Y, mean=x[1], sd=x[2], nu=x[3], xi=x[4])))
f}
start=c(mean(Y),sd(Y),4,1.5) # optimization starting point
fit_sstd = optim(start,loglik_std,method="L-BFGS-B",
lower=c(-.1,.001,2.1,0.5),
upper=c(.1,1,20,3))
print(c("MLE =",round(fit_sstd$par,digits=5)))
m_logL_sstd = fit_sstd$value  # minus the log-likelihood
AIC_std = 2*m_logL_sstd+2*length(fit_sstd$par)
fit_sstd
AIC_std
AIC_std
x1=pstd(Y,mean=fit_std$par[1],sd=fit_std$par[2],nu=fit_std$par[3])
x=qnorm(x1)
par(mfrow=c(1,1))
d1=density(Y)
plot(d1$x,d1$y,type="l",lty=1, xlab="y",ylab="density(y)")
d2=density(x)
ginvx=qstd(pnorm(d2$x),mean=fit_std$par[1],sd=fit_std$par[2],nu=fit_std$par[3])
gprime_num=dstd(ginvx,mean=fit_std$par[1],sd=fit_std$par[2],nu=fit_std$par[3])
gprime_den=dnorm(qnorm(pstd(ginvx,mean=fit_std$par[1],sd=fit_std$par[2],nu=fit_std$par[3])))
gprime=gprime_num/gprime_den
lines(ginvx,d2$y*gprime,type="l",lty=2)
legend("topleft",c("KDE","TKDE"),lty=c(1,2),lwd=2,cex=1.5)
d1=density(Y)
plot(d1$x,d1$y,type="l",lty=1, xlab="y",ylab="density(y)",xlim=c(0.035,0.06),ylim=c(0,2))
d2=density(x)
ginvx=qstd(pnorm(d2$x),mean=fit_std$par[1],sd=fit_std$par[2],nu=fit_std$par[3])
gprime_num=dstd(ginvx,mean=fit_std$par[1],sd=fit_std$par[2],nu=fit_std$par[3])
gprime_den=dnorm(qnorm(pstd(ginvx,mean=fit_std$par[1],sd=fit_std$par[2],nu=fit_std$par[3])))
gprime=gprime_num/gprime_den
lines(ginvx,d2$y*gprime,type="l",lty=2)
x_values=seq(min(Y),max(Y),length.out=150 )
lines(x_values,dstd(x_values,mean=fit_std$par[1],sd=fit_std$par[2],nu=fit_std$par[3]), type="l", lty=5 )
legend("topleft",c("KDE","TKDE","Parametric Estimator"),lty=c(1,2,5),lwd=1.5,cex=1.5)
